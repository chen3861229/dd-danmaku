# emby-danmaku

## Emby 弹幕插件

!截图

这是一个为 Emby 设计的弹幕插件，它能够从弹弹play获取弹幕并显示在播放器中。

## 安装

推荐使用第三方用户脚本加载器（如 **CustomCssJS**）来安装和管理此插件。此方式在不同客户端上具有最佳的兼容性和最便捷的管理体验。

关于其他安装方式，请参考原始项目文档。

## 近期主要变更

根据我们最近的修改，以下是此脚本的核心更新内容：

### ✨ 功能增强与优化

1.  **智能 API 切换与海报同步**
    *   **自动匹配**：现在会自动根据用户启用的 API（官方/自定义）进行匹配。当两者都启用时，会优先使用官方 API。
    *   **海报同步**：弹幕信息页面和手动匹配页面的海报图，现在会与实际使用的 API 来源保持严格一致。如果使用了自定义 API 并成功获取了海报，则会显示自定义海报，否则回退到官方海报。

2.  **更精准的标题匹配格式**
    *   插件现在会自动将剧集标题格式化为 `系列名称 SXXEYY` 的格式（例如 `Lycoris Recoil S01E01`）进行匹配，大大提高了多季度番剧的自动匹配准确率。

3.  **缓存管理**
    *   在“手动匹配”页面新增了“**清除本地匹配缓存**”按钮。当后端数据更新或自动匹配错误时，用户可以一键清除本地的匹配记录，强制插件重新进行在线匹配。

### 🎨 界面与体验优化

1.  **设置界面重构**
    *   将“API 选择”和“自定义 API 地址”设置项整合到了一个可折叠的区域中，使“手动匹配”页面更加整洁。
    *   调整了按钮布局和样式，使其更符合 Emby 的原生设计风格，提升了视觉一致性。

2.  **分集名显示修复**
    *   彻底解决了在手动匹配的集数选择下拉框中，分集名称显示为 `NaN` 或函数代码的 Bug。

### 🐛 Bug 修复

*   修复了在特定情况下，自定义 API 的 `/match` 接口返回结果无法被正确解析的问题。
*   修复了多处因代码逻辑不严谨可能导致的用户体验问题。
